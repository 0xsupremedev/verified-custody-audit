"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getFusionQuote = void 0;
const Helpers_1 = require("../../../modules/utils/Helpers.js");
const getOnChainQuote_1 = require("./getOnChainQuote.js");
const getPaymentToken_1 = require("./getPaymentToken.js");
const getPermitQuote_1 = require("./getPermitQuote.js");
const getFusionQuote = async (client, parameters) => {
    const paymentTokenInfo = await (0, getPaymentToken_1.getPaymentToken)(client, parameters.trigger);
    let permitEnabled = false;
    if (paymentTokenInfo.paymentToken) {
        permitEnabled = paymentTokenInfo.paymentToken.permitEnabled || false;
    }
    else if (paymentTokenInfo.isArbitraryPaymentTokensSupported) {
        const modularSmartAccount = client.account.deploymentOn(parameters.trigger.chainId, true);
        permitEnabled = await (0, Helpers_1.isPermitSupported)(modularSmartAccount.walletClient, parameters.trigger.tokenAddress);
    }
    else {
        throw new Error(`Payment token (${parameters.trigger.tokenAddress}) not supported for chain ${parameters.trigger.chainId}`);
    }
    return permitEnabled
        ? (0, getPermitQuote_1.default)(client, parameters)
        : (0, getOnChainQuote_1.default)(client, parameters);
};
exports.getFusionQuote = getFusionQuote;
exports.default = exports.getFusionQuote;
//# sourceMappingURL=getFusionQuote.js.map