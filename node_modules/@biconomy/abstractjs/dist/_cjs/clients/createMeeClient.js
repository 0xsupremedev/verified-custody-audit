"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createMeeClient = exports.DEFAULT_MEE_NODE_URL = void 0;
const Helpers_1 = require("../account/utils/Helpers.js");
const createHttpClient_1 = require("./createHttpClient.js");
const mee_1 = require("./decorators/mee/index.js");
exports.DEFAULT_MEE_NODE_URL = "https://mee-node.biconomy.io/v3";
const DEFAULT_PATHFINDER_URL = "https://network.biconomy.io/v1";
const DEFAULT_PATHFINDER_API_KEY = "mee_3ZZmXCSod4xVXDRCZ5k5LTHg";
const DEFAULT_STAGING_PATHFINDER_URL = "https://staging-network.biconomy.io/v1";
const DEFAULT_STAGING_PATHFINDER_API_KEY = "mee_3ZhZhHx3hmKrBQxacr283dHt";
const createMeeClient = async (params) => {
    const { account, pollingInterval = 1000, url = (0, Helpers_1.isStaging)() ? DEFAULT_STAGING_PATHFINDER_URL : DEFAULT_PATHFINDER_URL, apiKey = (0, Helpers_1.isStaging)()
        ? DEFAULT_STAGING_PATHFINDER_API_KEY
        : DEFAULT_PATHFINDER_API_KEY } = params;
    const httpClient = (0, createHttpClient_1.default)(url, apiKey);
    const info = await (0, mee_1.getInfo)(httpClient);
    const baseMeeClient = Object.assign(httpClient, {
        pollingInterval,
        account,
        info
    });
    const supportedChains = info.supportedChains.map(({ chainId }) => Number(chainId));
    const supported = account.deployments.every(({ chain }) => supportedChains.includes(chain.id));
    if (!supported) {
        throw new Error(`Some account chains are not supported by the MEE node. Please check the supported chains and try again. ${supportedChains.join(", ")}`);
    }
    return baseMeeClient.extend(mee_1.meeActions);
};
exports.createMeeClient = createMeeClient;
//# sourceMappingURL=createMeeClient.js.map