import { isStaging } from "../account/utils/Helpers.js";
import createHttpClient, {} from "./createHttpClient.js";
import { getInfo, meeActions } from "./decorators/mee/index.js";
export const DEFAULT_MEE_NODE_URL = "https://mee-node.biconomy.io/v3";
/**
  const STAKEPOOL_MEE_NODE_URL = "https://mainnet.mee.stakepool.dev.br/v3"
*/
/**
 * Default URL for the MEE node service
 */
const DEFAULT_PATHFINDER_URL = "https://network.biconomy.io/v1";
const DEFAULT_PATHFINDER_API_KEY = "mee_3ZZmXCSod4xVXDRCZ5k5LTHg";
const DEFAULT_STAGING_PATHFINDER_URL = "https://staging-network.biconomy.io/v1";
const DEFAULT_STAGING_PATHFINDER_API_KEY = "mee_3ZhZhHx3hmKrBQxacr283dHt";
export const createMeeClient = async (params) => {
    const { account, pollingInterval = 1000, url = isStaging() ? DEFAULT_STAGING_PATHFINDER_URL : DEFAULT_PATHFINDER_URL, apiKey = isStaging()
        ? DEFAULT_STAGING_PATHFINDER_API_KEY
        : DEFAULT_PATHFINDER_API_KEY } = params;
    const httpClient = createHttpClient(url, apiKey);
    const info = await getInfo(httpClient);
    const baseMeeClient = Object.assign(httpClient, {
        pollingInterval,
        account,
        info
    });
    // Check if the account is supported by the MEE node. Throws if not.
    const supportedChains = info.supportedChains.map(({ chainId }) => Number(chainId));
    const supported = account.deployments.every(({ chain }) => supportedChains.includes(chain.id));
    if (!supported) {
        throw new Error(`Some account chains are not supported by the MEE node. Please check the supported chains and try again. ${supportedChains.join(", ")}`);
    }
    return baseMeeClient.extend(meeActions);
};
//# sourceMappingURL=createMeeClient.js.map